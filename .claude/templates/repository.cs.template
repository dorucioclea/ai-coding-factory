// Repository Template
// Story: {{StoryId}}
// Generated by Claude Code

// --- Repository Interface (Domain Layer) ---
namespace {{Namespace}}.Domain.Repositories;

/// <summary>
/// Repository interface for {{EntityName}} entities.
/// </summary>
public interface I{{EntityName}}Repository : IRepository<{{EntityName}}>
{
    /// <summary>
    /// Gets a {{EntityName}} by its unique identifier.
    /// </summary>
    Task<{{EntityName}}?> GetByIdAsync(Guid id, CancellationToken ct = default);

    /// <summary>
    /// Gets a {{EntityName}} by ID with related entities.
    /// </summary>
    Task<{{EntityName}}?> GetByIdWithDetailsAsync(Guid id, CancellationToken ct = default);

    /// <summary>
    /// Gets all {{EntityName}}s matching the specification.
    /// </summary>
    Task<IEnumerable<{{EntityName}}>> GetAllAsync(CancellationToken ct = default);

    /// <summary>
    /// Adds a new {{EntityName}}.
    /// </summary>
    Task AddAsync({{EntityName}} entity, CancellationToken ct = default);

    /// <summary>
    /// Updates an existing {{EntityName}}.
    /// </summary>
    void Update({{EntityName}} entity);

    /// <summary>
    /// Removes a {{EntityName}}.
    /// </summary>
    void Remove({{EntityName}} entity);
}


// --- Repository Implementation (Infrastructure Layer) ---
namespace {{Namespace}}.Infrastructure.Repositories;

using Microsoft.EntityFrameworkCore;
using {{Namespace}}.Domain.Entities;
using {{Namespace}}.Domain.Repositories;
using {{Namespace}}.Infrastructure.Persistence;

/// <summary>
/// Repository implementation for {{EntityName}} entities.
/// </summary>
public class {{EntityName}}Repository : I{{EntityName}}Repository
{
    private readonly ApplicationDbContext _context;

    public {{EntityName}}Repository(ApplicationDbContext context)
    {
        _context = context;
    }

    public async Task<{{EntityName}}?> GetByIdAsync(Guid id, CancellationToken ct = default)
    {
        return await _context.{{EntityName}}s.FindAsync(new object[] { id }, ct);
    }

    public async Task<{{EntityName}}?> GetByIdWithDetailsAsync(Guid id, CancellationToken ct = default)
    {
        return await _context.{{EntityName}}s
            // .Include(e => e.RelatedEntities)
            .FirstOrDefaultAsync(e => e.Id == id, ct);
    }

    public async Task<IEnumerable<{{EntityName}}>> GetAllAsync(CancellationToken ct = default)
    {
        return await _context.{{EntityName}}s
            .OrderByDescending(e => e.CreatedAt)
            .ToListAsync(ct);
    }

    public async Task AddAsync({{EntityName}} entity, CancellationToken ct = default)
    {
        await _context.{{EntityName}}s.AddAsync(entity, ct);
    }

    public void Update({{EntityName}} entity)
    {
        _context.{{EntityName}}s.Update(entity);
    }

    public void Remove({{EntityName}} entity)
    {
        _context.{{EntityName}}s.Remove(entity);
    }
}
