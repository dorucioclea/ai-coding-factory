// React Context Template
// Story: {{StoryId}}
// Generated by Claude Code

import {
  createContext,
  useContext,
  useReducer,
  useCallback,
  useMemo,
  ReactNode,
  FC,
} from 'react';

// ============================================================================
// Types
// ============================================================================

/**
 * State shape for the {{ContextName}} context.
 */
export interface {{ContextName}}State {
  // Add state properties
  isLoading: boolean;
  error: Error | null;
  // data: {{DataType}} | null;
}

/**
 * Actions that can be dispatched to the reducer.
 */
type {{ContextName}}Action =
  | { type: 'SET_LOADING'; payload: boolean }
  | { type: 'SET_ERROR'; payload: Error | null }
  | { type: 'RESET' };
  // | { type: 'SET_DATA'; payload: {{DataType}} };

/**
 * Context value including state and actions.
 */
interface {{ContextName}}ContextValue extends {{ContextName}}State {
  // Actions
  setLoading: (loading: boolean) => void;
  setError: (error: Error | null) => void;
  reset: () => void;
  // Additional methods
  // fetchData: () => Promise<void>;
}

// ============================================================================
// Initial State & Reducer
// ============================================================================

const initial{{ContextName}}State: {{ContextName}}State = {
  isLoading: false,
  error: null,
  // data: null,
};

function {{contextName}}Reducer(
  state: {{ContextName}}State,
  action: {{ContextName}}Action
): {{ContextName}}State {
  switch (action.type) {
    case 'SET_LOADING':
      return { ...state, isLoading: action.payload };
    case 'SET_ERROR':
      return { ...state, error: action.payload, isLoading: false };
    case 'RESET':
      return initial{{ContextName}}State;
    // case 'SET_DATA':
    //   return { ...state, data: action.payload, isLoading: false };
    default:
      return state;
  }
}

// ============================================================================
// Context
// ============================================================================

const {{ContextName}}Context = createContext<{{ContextName}}ContextValue | null>(null);

{{ContextName}}Context.displayName = '{{ContextName}}Context';

// ============================================================================
// Provider
// ============================================================================

export interface {{ContextName}}ProviderProps {
  children: ReactNode;
  /** Initial state override for testing */
  initialState?: Partial<{{ContextName}}State>;
}

/**
 * Provider component for {{ContextName}} context.
 *
 * @example
 * ```tsx
 * <{{ContextName}}Provider>
 *   <App />
 * </{{ContextName}}Provider>
 * ```
 */
export const {{ContextName}}Provider: FC<{{ContextName}}ProviderProps> = ({
  children,
  initialState,
}) => {
  const [state, dispatch] = useReducer(
    {{contextName}}Reducer,
    { ...initial{{ContextName}}State, ...initialState }
  );

  // Action creators
  const setLoading = useCallback((loading: boolean) => {
    dispatch({ type: 'SET_LOADING', payload: loading });
  }, []);

  const setError = useCallback((error: Error | null) => {
    dispatch({ type: 'SET_ERROR', payload: error });
  }, []);

  const reset = useCallback(() => {
    dispatch({ type: 'RESET' });
  }, []);

  // Memoized context value
  const value = useMemo<{{ContextName}}ContextValue>(
    () => ({
      ...state,
      setLoading,
      setError,
      reset,
    }),
    [state, setLoading, setError, reset]
  );

  return (
    <{{ContextName}}Context.Provider value={value}>
      {children}
    </{{ContextName}}Context.Provider>
  );
};

// ============================================================================
// Hook
// ============================================================================

/**
 * Hook to access {{ContextName}} context.
 *
 * @throws Error if used outside of {{ContextName}}Provider
 *
 * @example
 * ```tsx
 * const { isLoading, error, setLoading } = use{{ContextName}}();
 * ```
 */
export function use{{ContextName}}(): {{ContextName}}ContextValue {
  const context = useContext({{ContextName}}Context);

  if (!context) {
    throw new Error(
      'use{{ContextName}} must be used within a {{ContextName}}Provider'
    );
  }

  return context;
}

// ============================================================================
// Selector Hooks (for performance optimization)
// ============================================================================

/**
 * Select only the loading state to minimize re-renders.
 */
export function use{{ContextName}}Loading(): boolean {
  const { isLoading } = use{{ContextName}}();
  return isLoading;
}

/**
 * Select only the error state to minimize re-renders.
 */
export function use{{ContextName}}Error(): Error | null {
  const { error } = use{{ContextName}}();
  return error;
}

export default {{ContextName}}Provider;
